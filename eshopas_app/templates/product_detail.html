{% extends 'base.html' %}
{% load static %}
{% load myfilters %}
<link href="{% static 'css/styles.css' %}" rel="stylesheet">

{% block content %}
  <h1>{{ product.name }}</h1>
  <p><strong>Price:</strong> ${{ product.price }}</p>
  <!-- Display other product details and image here -->

  <p><strong>Category:</strong> {{ product.category.name }}</p>
  <h2>Description:</h2>
  <div>{{ product.description|safe }}</div>
    <form method="post" action="{% url 'add_to_cart' product.id %}">
        {% csrf_token %}
        <button type="submit">Add to Cart</button>
    </form>
  <!-- Favorite item -->
  {% if user.is_authenticated %}
      {% if user in product.favorites.all %}
          <h2><strong>Favorite item:</strong> ❤️</h2> <!-- Already in favorites -->
      {% else %}
          <h2><strong>Favorite item:</strong> <a href="{% url 'toggle_favorite' product_id=product.id %}">♡</a></h2> <!-- Not in favorites -->
      {% endif %}
  {% endif %}
  {% if comments %}
    <h2>Comments</h2>
    <ul>
      {% for comment in comments %}
        <li>
          Comment.by {{ comment.user.username }}
          <img src="{{ comment.user.profile.thumbnail.url }}" width="40" height="40">
          - {{ comment.comment }}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No comments yet.</p>
  {% endif %}

  <!-- Add comment form -->
  {% if user.is_authenticated %}
    <h2>Add Comment</h2>
    <form method="post" action="{% url 'add_comment' product.id %}">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit">Submit Comment</button>
    </form>
  {% else %}
    <p>You must be logged in to leave a comment.</p>
  {% endif %}

  <h3>Related Products</h3>
  <div class="related-products">
    {% for related_product in related_products %}
      <div class="related-product">
        <h4>{{ related_product.name }}</h4>
        <p>Price: ${{ related_product.price }}</p>
        <a href="{% url 'product_detail' related_product.id %}">View Details</a>
      </div>
    {% endfor %}
  </div>

  <!-- Back to Main Page button -->
  <a href="{% url 'index' %}" class="btn btn-primary">Back to Main Page</a>
{% endblock %}
